https://leetcode.com/problems/count-submatrices-with-all-ones/description/?envType=daily-question&envId=2025-08-21

```
class Solution {
public:
    int numSubmat(vector<vector<int>>& mat) {
        int m = mat.size();
        int n = mat[0].size();
        int res = 0;
        vector<int>ht(n, 0);
        for(const auto& i : mat){
            for(int j = 0; j < n; j++){
                ht[j] = (i[j] == 0) ? 0 : ht[j] + 1;
            }
            stack<vector<int>>st;
            st.push({-1, 0, -1});
            for(int j = 0; j < n; j++){
                int h = ht[j];
                while(st.top()[2] >= h){
                    st.pop();
                }
                auto tp = st.top();
                int gap = tp[0];
                int prev = tp[1];
                int cur = prev + (j - gap) * h;
                st.push({j, cur, h});
                res += cur;
            }
        }
        return res;
    }
};
```
